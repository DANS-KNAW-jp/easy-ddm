Easy Pakbon Preprocess
======================
Converts the EASY dataset using information from corresponding a pakbon file.  
This dataset can then be ingested using the easy-ebiu tool. 

The preprocessor looks for pakbon files in 'dataset' directories and will change the folders content. 
It assumes that pakbon files are xml files (with the xml extension) and that they are placed in the root (topmost directory) of the 'dataset' folder. 
A schematic representation of a 'dataset' directory is shown below.

        /+ {pakbon file *.xml}
         +- filedata/
         |  + {pakbon.xml}
         |  + {files and directories to be ingested}
         +- metadata/
            + easymetadata.xml
            + administrative-metadata.xml
            + resource-metadata-list.xml

Using the information in the pakbon file it does the following: 
- Creates the metadata/easymetadata.xml file  (it will overwrite any existing one!)
- Places a copy of the pakbon file in filedata. 
- Copies administrative-metadata.xml (as configured) into the metadata directory. 


Installation
------------
Unzip the archive file (tar.gz) in /opt
$ tar -zxvf easy-pakbon-preprocess-1.0-SNAPSHOT.tar.gz -C /opt
Change owner, if needed
$ chown -R {user}:{user} easy-pakbon-preprocess-1.0-SNAPSHOT
Change permissions
$ chmod -R 755  easy-pakbon-preprocess-1.0-SNAPSHOT
Make a 'versionless' link 
$ ln -s easy-pakbon-preprocess-1.0-SNAPSHOT easy-pakbon-preprocess


Configuration
-------------
Create directory structure for the datasets idf you don't have them. 
Note that you need those for the easy-ebiu tool. 
$ mkdir -p ~/batch/ingest
$ mkdir -p ~/batch/update-files
$ mkdir -p ~/batch/update-metadata

Set the following variables in your shell configuration (.bashrc file)
export EASY_PAKBON_HOME=/opt/easy-pakbon-preprocess
export PATH=$PATH:$EASY_PAKBON_HOME/bin

Note that you probably will have similar lines for easy-ebiu (EASY_EBIU_HOME).

The easy-pakbon-preprocessor also has configuration files in its cfg directory: 
/opt/easy-pakbon-preprocess/cfg 
all contain options that cannot be set via the commandline. 
- administrative-metadata.xml 
  contains the depositorId and dataset status and is copied to each dataset metadata directory. 
  NOTE: You might want to change this depending on the datasets!
- easy-pakbon-preprocess-config.properties 
  has values for the application that will change seldom. 
- logback.xml 
  determines the way messages are logged, also no need to change those in normal usage.  
 

Usage:
------
The easy-pakbon.preprocess script need a directory to work on. 
Type easy-pakbon-preprocess.sh -h
for help about the options
 
There are three extra scripts that don't need the directory specified.  
Each corresponds to one of the subdirectories of the batch folder that it works on:  
- easy-pakbon-preprocess-ingest.sh 
- easy-pakbon-preprocess-update-files.sh 
- easy-pakbon-preprocess-update-metadata.sh 


Reports are written into csv files:  
~/batch/reports/pakbon-preprocess/

logs with more (detailed) information in text files:  
~/batch/logs/pakbon-preprocess/

